<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixel Grid Editor</title>
<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: Arial, sans-serif;
        background-color: #222;
        color: white;
    }
    #grid {
        display: grid;
        grid-template-columns: repeat(64, 10px);
        grid-template-rows: repeat(64, 10px);
        gap: 1px;
        margin-top: 20px;
    }
    .cell {
        width: 10px;
        height: 10px;
        background-color: white;
        text-align: center;
        line-height: 10px;
        font-size: 6px;
        color: white;
    }
    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    button {
        padding: 5px 10px;
        cursor: pointer;
    }
    #colorPicker {
        width: 40px;
        height: 40px;
        padding: 0;
        border: none;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>Pixel Grid Editor</h1>
<div class="controls">
    <input type="color" id="colorPicker">
    <div id="charButtons"></div>
    <button onclick="saveGrid()">Save</button>
    <input type="file" id="fileInput" accept=".json">
    <button onclick="clearGrid()">Clear</button>
</div>
<div id="coordinates"></div>
<div id="grid"></div>

<script>
let isMouseDown = false;
let currentColor = null;
let currentChar = null;
let cells = [];

document.body.addEventListener('mousedown', () => isMouseDown = true);
document.body.addEventListener('mouseup', () => isMouseDown = false);

// Initialize grid
function initGrid() {
    const grid = document.getElementById('grid');
    for (let i = 0; i < 4096; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = i;

        cell.addEventListener('mousedown', (e) => {
            e.preventDefault();
            isMouseDown = true;
            paintCell(i);
        });

        cell.addEventListener('mouseenter', () => {
            if (isMouseDown) paintCell(i);
            updateCoordinates(i);
        });

        // Allow single click without drag
        cell.addEventListener('click', () => {
            paintCell(i);
        });

        grid.appendChild(cell);
    }
}

// Paint cell
function paintCell(index) {
    const cell = document.querySelector(`[data-index="${index}"]`);
    const cellData = cells[index];

    if (currentChar !== null) {
        cellData.char = currentChar;
        cell.textContent = currentChar;
        cell.style.fontSize = '6px';
        cellData.color = null;
        cell.style.backgroundColor = '';

        // Make text black if background is white, else white
        if (currentColor === '#FFFFFF') {
            cell.style.color = '#000000';
            cellData.textColor = '#000000';
        } else {
            cell.style.color = '#ffffff';
            cellData.textColor = '#ffffff';
        }
    } else if (currentColor !== null) {
        cellData.color = currentColor;
        cell.style.backgroundColor = currentColor;
        cellData.char = null;
        cellData.textColor = null;
        cell.textContent = '';
        cell.style.color = '';
    }

    saveToLocalStorage();
}

// Save grid to JSON file
function saveGrid() {
    const dataStr = JSON.stringify(cells);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'grid.json';
    a.click();
}

// Load grid from JSON file
document.getElementById('fileInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const data = JSON.parse(e.target.result);
            loadGrid(data);
        };
        reader.readAsText(file);
    }
});

function loadGrid(data) {
    cells = data;
    const gridCells = document.querySelectorAll('.cell');
    gridCells.forEach((cell, i) => {
        const cellData = cells[i];
        if (cellData.color) {
            cell.style.backgroundColor = cellData.color;
            cell.textContent = '';
            cell.style.color = '';
        } else if (cellData.char) {
            cell.textContent = cellData.char;
            cell.style.color = cellData.textColor || '#ffffff';
            cell.style.fontSize = '6px';
            cell.style.backgroundColor = '';
        } else {
            cell.style.backgroundColor = '';
            cell.textContent = '';
            cell.style.color = '';
        }
    });
    saveToLocalStorage();
}

// Clear grid
function clearGrid() {
    cells = Array(4096).fill().map(() => ({ color: null, char: null, textColor: null }));
    const gridCells = document.querySelectorAll('.cell');
    gridCells.forEach(cell => {
        cell.style.backgroundColor = '';
        cell.textContent = '';
        cell.style.color = '';
    });
    saveToLocalStorage();
}

// Update coordinates display
function updateCoordinates(index) {
    const x = index % 64;
    const y = Math.floor(index / 64);
    document.getElementById('coordinates').textContent = `X: ${x}, Y: ${y}`;
}

// Color picker
document.getElementById('colorPicker').addEventListener('input', function() {
    currentColor = this.value;
    currentChar = null;
});

// Create hex character buttons
function createCharButtons() {
    const chars = '0123456789ABCDEF';
    const container = document.getElementById('charButtons');
    chars.split('').forEach(char => {
        const btn = document.createElement('button');
        btn.textContent = char;
        btn.addEventListener('click', () => {
            currentChar = char;
            currentColor = document.getElementById('colorPicker').value;
        });
        container.appendChild(btn);
    });
}

// Local storage handling
function saveToLocalStorage() {
    localStorage.setItem('pixelGrid', JSON.stringify(cells));
}

function loadFromLocalStorage() {
    const saved = localStorage.getItem('pixelGrid');
    if (saved) {
        cells = JSON.parse(saved);
        const gridCells = document.querySelectorAll('.cell');
        gridCells.forEach((cell, i) => {
            const cellData = cells[i];
            if (cellData.color) {
                cell.style.backgroundColor = cellData.color;
                cell.textContent = '';
                cell.style.color = '';
            } else if (cellData.char) {
                cell.textContent = cellData.char;
                cell.style.color = cellData.textColor || '#ffffff';
                cell.style.fontSize = '6px';
                cell.style.backgroundColor = '';
            } else {
                cell.style.backgroundColor = '';
                cell.textContent = '';
                cell.style.color = '';
            }
        });
    } else {
        cells = Array(4096).fill().map(() => ({ color: null, char: null, textColor: null }));
    }
}

// Initialize app
initGrid();
createCharButtons();
loadFromLocalStorage();
</script>

</body>
</html>
